{% extends "page_base.html" %}

{% block all_content %}
  <form id="edit-profile-form" method="post" action="." enctype="multipart/form-data">
    {% csrf_token %}

    <div class="section-aside">
      <img id="img-for-profile" class="profile-avatar" src="{{ profile.get_avatar }}" />
      <span class="profile-details">
        {{ form.avatar }}
      </span>
    </div>

    <div class="section-main">
      <h2>Update Your Profile</h2>
      {{ form.user }}
      {{ form.errors }}
      <div class="spacer"></div>
      <table class="{% block form_table_class %}{% endblock %}">
        <tr><td colspan="2">{{ form.nickname.errors }}</td></tr>
        <tr>
            <th><label for="id_nickname">{{ form.nickname.label }}:</label></td>
            <td>{{ form.nickname }}</label>
        <tr>
            <td></td><td><input type="submit" value="Update Profile"></td>
        </tr>
      </table>
    </div>
  </form>
{% endblock %}

{% block body_script %}
  function updateAvatar(input) {
    // when we upload a file, change the image to match
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#img-for-profile').attr("src", e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
  }
  $("#id_avatar").change(function(){ updateAvatar(this); });
{% endblock %}