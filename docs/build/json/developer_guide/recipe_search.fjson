{"body": "<div class=\"section\" id=\"searching-recipes\">\n<h1>Searching Recipes<a class=\"headerlink\" href=\"#searching-recipes\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>NoDonuts uses a plugin called Haystack to manage searches, and a search engine\ncalled Whoosh to index all of its recipes.</p>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">Currently there is a bug in django-haystack that causes errors during\nupdate to cascade across all other updates. Until this is fixed in the\nmain version of django-haystack, this project uses a custom fork of the\nproject.  Please see references at the bottom of this documentation for a\nlink to the forked project.</p>\n</div>\n<div class=\"section\" id=\"configuring-search\">\n<h2>Configuring Search<a class=\"headerlink\" href=\"#configuring-search\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Whoosh generates file-based search indexes that are used to run queries\nwithout hitting the database. In order for the search to work correctly, the\nsearch indexes have to be regenerated on a regular basis.</p>\n<div class=\"section\" id=\"initial-search-index-creation\">\n<h3>Initial Search Index Creation<a class=\"headerlink\" href=\"#initial-search-index-creation\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Create a folder in <tt class=\"docutils literal\"><span class=\"pre\">nodonunts/nodonuts</span></tt> called <tt class=\"docutils literal\"><span class=\"pre\">whoosh_index</span></tt> and run the\nfollowing command to generate the initial set of indexes:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre>python manage.py rebuild_index\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"updating-search-indexes\">\n<h3>Updating Search Indexes<a class=\"headerlink\" href=\"#updating-search-indexes\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The search indexes will need to be updated whenever new recipes/tags are added\nor recipes change.  You can do this manually by running:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre>python manage.py update_index recipes\n</pre></div>\n</div>\n<p>To automate this, you may consider creating a cron job on your server. Here is\nan example entry that updates the recipes once every hour:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre>0 * * * *  cd &lt;path to project&gt; &amp;&amp; &lt;path to venv&gt;/bin/python \\\nmanage.py update_index recipes\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"advanced-update\">\n<h3>Advanced Update<a class=\"headerlink\" href=\"#advanced-update\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you want something more advanced or your hosting provider does not support\ncron jobs, you can also use <a class=\"reference external\" href=\"http://celery.readthedocs.org/en/latest/\">Celerybeat</a>.\nThis project is already configured to use Celery&#8217;s database task queue backend\nto update the recipes once per hour.</p>\n<p>If you would like the search indexes to update more frequently (or less\nfrequently), you can adjust the <tt class=\"docutils literal\"><span class=\"pre\">CELERYBEAT_SCHEDULE</span></tt> setting in your\n<tt class=\"docutils literal\"><span class=\"pre\">srv_settings.py</span></tt> file.  Adjust the <tt class=\"docutils literal\"><span class=\"pre\">schedule</span></tt> value to be whatever frequency\nyou would like it to check for updates. For example, if you want it to run\nevery 15 minutes, your config might look like:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">CELERYBEAT_SCHEDULE</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s\">&#39;update-recipe-search-index&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;task&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;recipe.tasks.update_recipe_indices&#39;</span><span class=\"p\">,</span>\n        <span class=\"s\">&#39;schedule&#39;</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">timedelta</span><span class=\"p\">(</span><span class=\"n\">minutes</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">),</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>To run celerybeat in a development environment, you can use:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre>python manage.py celerybeat\n</pre></div>\n</div>\n<p>For production, celery should be daemonized. Celery has a\n<a class=\"reference external\" href=\"http://celery.readthedocs.org/en/latest/tutorials/daemonizing.html?highlight=celerybeat%20daemon\">tutorial on writing a daemon</a>\nfor celerybeat.</p>\n</div>\n<div class=\"section\" id=\"configuring-number-of-search-results-per-page\">\n<h3>Configuring Number of Search Results Per Page<a class=\"headerlink\" href=\"#configuring-number-of-search-results-per-page\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>By default, the search returns 10 results per page. You can change this from\nthe <a class=\"reference external\" href=\"/site-manager/\">Django admin</a> by going to <a class=\"reference external\" href=\"/site-manager/constance/config/\">Constance - Config</a>\nand updating the SEARCH_RESULTS_PER_PAGE setting.</p>\n</div>\n</div>\n<div class=\"section\" id=\"search-basics\">\n<h2>Search Basics<a class=\"headerlink\" href=\"#search-basics\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>The search page is located at <a class=\"reference external\" href=\"/search/\">/search/</a>. There\nare four GET parameters that can be used with the search:</p>\n<dl class=\"docutils\">\n<dt><em class=\"dfn\">q</em></dt>\n<dd>Keyword search terms. These will match any recipes that have these terms in\nthe title, ingredients, or tags.</dd>\n<dt><em class=\"dfn\">tags</em></dt>\n<dd>Tag literals, separated by spaces. These will match the tags in a recipe</dd>\n<dt><em class=\"dfn\">ss</em></dt>\n<dd><p class=\"first\">Serving size &#8211; i.e., how many people this recipe will serve. The number\nentered must match one of the following:</p>\n<ul class=\"simple\">\n<li>0: 1-2 people</li>\n<li>1: 3-4 people</li>\n<li>2: 5-6 people</li>\n<li>3: 7-9 people</li>\n<li>4: 10-12 people</li>\n<li>5: 12-15 people</li>\n<li>6: 15-20 people</li>\n<li>7: 20-30 people</li>\n<li>8: 30-50 people</li>\n<li>9: More than 50 people</li>\n</ul>\n<p class=\"last\">These options can be found in recipes.models.ServingSize. People using the\nsearch will not have to enter these numbers manually, as the form provides\na dropdown with the appropriate options.</p>\n</dd>\n<dt><em class=\"dfn\">order</em></dt>\n<dd><p class=\"first\">Order that the tags should be returned. The options currently are:</p>\n<ul class=\"simple\">\n<li>popularity</li>\n<li>newest</li>\n<li>alphabeta (alphabetical ordering A-Z)</li>\n<li>alphabetz (alphabetical ordering Z-A)</li>\n</ul>\n<p class=\"last\">These options can be found in recipes.forms.RecipeSearchForm.</p>\n</dd>\n</dl>\n<p>Currently all searches are &#8216;AND&#8217; searches (i.e., they must match all parameters\nin the search box).</p>\n<div class=\"section\" id=\"searching-from-the-home-page\">\n<h3>Searching from the Home Page<a class=\"headerlink\" href=\"#searching-from-the-home-page\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Most pages (including the home page) have a keyword search bar (i.e., the bar\npasses the <cite>q</cite> parameter for anything entered in the search bar).  Clicking the\nsearch icon next to the bar, with or without keywords entered, will go directly\nto the <a class=\"reference external\" href=\"/search/\">search</a> page. If no search terms are entered, the user will\nsee a page all results ordered by popularity; otherwise, the page returns a\nlist of any recipes that match the keywords.</p>\n<p>The home page has two other ways to access the search page:</p>\n<ul class=\"simple\">\n<li><strong>tag search:</strong> the page sidebar displays a list of tags, organized by the</li>\n</ul>\n<p>type of tag. Clicking on any of these tags will take the user to a list of\nrecipes filtered by that tag.\n* <strong>browse link:</strong> under the &#8216;Newest Recipes&#8217; section, is a link to &#8216;Browse&#8217;,\nwhich takes the user to a list of recipes ordered by when they were added,\nnewest first.</p>\n</div>\n<div class=\"section\" id=\"searching-from-the-search-page\">\n<h3>Searching from the Search Page<a class=\"headerlink\" href=\"#searching-from-the-search-page\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The search page provides access to all four of the search parameters above:</p>\n<ul class=\"simple\">\n<li><strong>q:</strong> keywordtext field in the search form</li>\n<li><strong>tags:</strong> by clicking links in the sidebar or using text field in the search form</li>\n<li><strong>order:</strong> dropdown to select popularity, newest, or both types of</li>\n</ul>\n<p>alphabetical search\n* <strong>ss:</strong> dropdown with serving size options</p>\n</div>\n</div>\n<div class=\"section\" id=\"advanced-search-syntax\">\n<h2>Advanced Search Syntax<a class=\"headerlink\" href=\"#advanced-search-syntax\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>There are two syntax options that can be used with the keyword (<cite>q</cite>) search\nfield:</p>\n<ul class=\"simple\">\n<li><strong>quotation marks:</strong> performs a literal search. For example, <cite>&#8220;dairy free&#8221;</cite></li>\n</ul>\n<p>(with quotes) would return:</p>\n<blockquote>\n<div><p>Dairy Free Mac and Cheese (Title)\ndairy-free creamer (ingredient)\ndairy-free (tag)</p>\n<p>Whereas <cite>dairy free</cite> (without quotes) may return results like:</p>\n<p>Dairy Free Mac and Cheese (Title)\nFat-Free Mac and Cheese (with &#8216;dairy&#8217; tag)\ndairy-free (tag)\nDairy Delight (with &#8216;nut-free&#8217; tag)</p>\n</div></blockquote>\n<ul class=\"simple\">\n<li><strong>minus sign:</strong> exludes a search term. For example, <cite>peanuts -curry</cite> would</li>\n</ul>\n<p>return any results that had peanuts in the title or ingredients, but not the\nword &#8216;curry&#8217;.</p>\n<div class=\"admonition seealso\">\n<p class=\"first admonition-title\">See also</p>\n<dl class=\"last docutils\">\n<dt><a class=\"reference external\" href=\"http://django-haystack.readthedocs.org/en/latest/\">Django-haystack project documention</a></dt>\n<dd>A general reference for the views and search API</dd>\n<dt><a class=\"reference external\" href=\"https://github.com/kamni/django-haystack\">Fork of the django-haystack project</a></dt>\n<dd>The version of django-haystack used for this project</dd>\n<dt><a class=\"reference external\" href=\"http://pythonhosted.org/Whoosh/intro.html\">Whoosh documentation</a></dt>\n<dd>Basics of the search engine being used for this project</dd>\n<dt><a class=\"reference external\" href=\"http://celery.readthedocs.org/en/latest/django/index.html\">Celery docs for Django</a></dt>\n<dd>More options for configuring Celery</dd>\n</dl>\n</div>\n</div>\n</div>\n", "display_toc": true, "title": "Searching Recipes", "sourcename": "developer_guide/recipe_search.txt", "customsidebar": null, "current_page_name": "developer_guide/recipe_search", "next": null, "rellinks": [["genindex", "General Index", "I", "index"], ["index", "NoDonuts: Let&#8217;s get the junk food out of our campaigns!", "P", "previous"]], "meta": {}, "parents": [], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Searching Recipes</a><ul>\n<li><a class=\"reference internal\" href=\"#configuring-search\">Configuring Search</a><ul>\n<li><a class=\"reference internal\" href=\"#initial-search-index-creation\">Initial Search Index Creation</a></li>\n<li><a class=\"reference internal\" href=\"#updating-search-indexes\">Updating Search Indexes</a></li>\n<li><a class=\"reference internal\" href=\"#advanced-update\">Advanced Update</a></li>\n<li><a class=\"reference internal\" href=\"#configuring-number-of-search-results-per-page\">Configuring Number of Search Results Per Page</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#search-basics\">Search Basics</a><ul>\n<li><a class=\"reference internal\" href=\"#searching-from-the-home-page\">Searching from the Home Page</a></li>\n<li><a class=\"reference internal\" href=\"#searching-from-the-search-page\">Searching from the Search Page</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#advanced-search-syntax\">Advanced Search Syntax</a></li>\n</ul>\n</li>\n</ul>\n", "prev": {"link": "../../", "title": "NoDonuts: Let&#8217;s get the junk food out of our campaigns!"}, "metatags": ""}